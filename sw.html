
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>White-Sparrow</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/x-icon" href="icon512_maskable.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <style>
        body {
            background: #000;
            color: #fff;
            background-image:url('movback.svg');
            background-attachment:fixed;
            background-size:cover;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 10px;
        }

        h3 {
            color: #fff;
            font-size: 18px;
        }

        input, button ,select{
            display: block;
            width: 90%;
            margin: 8px auto;
            padding: 12px;
            border: 1px solid #808080;
            border-radius: 5px;
            font-size: 14px;
        }

        input ,select{
            background: #000;
            color: #fff;
        }

        input::placeholder {
            color: #fff;
        }

        button {
            background: #000;
            color: #fff;
            cursor: pointer;
        }

        button:active {
            background: #111;
        }

        pre {
        
            background: #000;
            padding: 10px;
            border: 1px solid #808080;
            border-radius: 5px;
            text-align: left;
            width: 48%;
            margin: 8px auto;
            font-size: 12px;
            overflow-x: auto;
        }
        .pr{
        display:flex;
        width:100%;
        height:40%;
        gap:10px;
        
        }
        
        a{
        color:white;
        }
        
        .fa-circle-info{
        position:absolute;
        z-index:30;
        top:10;
        font-size:1.5rem;
        right:5;
        color:green;
        }
        a{
        text-decoration:none;
        color:green;
        
        }
        
        details {
        margin-bottom: 10px;
        border:none;
        padding: 10px;
        text-align:left;
        border-radius: 5px;
        background-color:black;
        }
        summary {
        font-weight: bold;
        cursor: pointer;
        }
        .warning {
        color: red;
        font-weight: bold;
        }
        
        select,.sele>input,.sele>button{
        border:1px solid grey;
        }
        #out{
        border:3px solid green;
        background-color:black;
        color:white;
        }
        #out2{
        background-color:black;
        border:3px solid skyblue;
        
        color:white;
        }
        
        .sele input{
        border:1px solid black;
        border-bottom:1px solid grey;
        color:white;
        }
        .sele input::placeholder{
        color:white;
        }
        .sele input:hover{
        border-bottom:1px solid black;
        }
        
        .sug-box {padding:0px; font-family: monospace; width:90%; background:#800000; border: 0px solid black;border-bottom:1px solid grey; max-height: 150px; overflow-y: auto; display: none; z-index: 10; border-radius:5px;}
        .sug-item { padding: 8px; cursor: pointer; color:white; }
        .sug-item:hover { background: grey; }
        
        #selcat{
        background-color:#6A1B9A;
        border:1px solid grey;
        }
        .sele input:nth-child(2){
        background-color:#183D3D;
        border:0px solid grey;
        border-bottom:1px solid grey;
        }
        .sele input:nth-child(2)::placeholder{
        color:white;
        }
        h2{
        margin:0px;
        padding:0px;
        }
        
        .btns{
        width:99%;
        display:flex;
        justify-content:space-between;
        align-items:center;
        marhin:5px;
        }
        .btns button,.btns select,i{
        margin:2px;
        width:auto;
        }
        .fa-download{
        
        font-size:1.4rem;
        }
    </style>
    <link rel="stylesheet" href=" https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>
<body>
<i onclick="ddoc()" class="fa-solid fa-circle-info"></i>
    <h2>White Sparrow </h2>
    
    <details id="dic">
    <summary style="display:none;">sjjs</summary>
    <details>
    <summary>Step 1 : Upload Password File (if exists)</summary>
    <p> Click On PassWD button and Enter the <strong>Breeze password</strong> to read <strong>Sky & Breeze</strong> values and autofill input boxes.</p>
    </details>
    
    <details>
    <summary>Step 2 : Upload Data File (if exists)</summary>
    <p> Click On DataFile button and it Requires the <strong>password file first</strong>. it will Read and displays <strong>encrypted & decrypted</strong> data.</p>
    </details>
    
    <details>
    <summary>Step 3 : Create Files</summary>
    <p>If no files exist, first create a <strong>password file in Black Sparrow</strong>, then Choose or Create An Document Structure By Click On Select Docs Button.</p>
    </details>
    
    <details>
    <summary>Step 4 : Upload Data</summary>
    <p>Enter <strong>key-value pairs</strong> (data reference & value). If a data refrences exists, it updates the data.</p>
    </details>
    
    <details>
    <summary>Step 5 : Download Data File</summary>
    <p> Click On Download icon to Download Consealed Data File With <strong>Breeze password</strong>.</p>
    </details>
    <p> Reload The Page If Any Unknkwn Problem Occured</p>
    <p class="warning"> If the Breeze password is forgotten, everything is lost.</p>
    <a href="sdoc.html" > Click Here Read Sparrow Documentation.</a>
    </details>
    
    <div class="btns">
    <button id="uppf"> PassWD</button>
    <input style="display:none;" type="file" id="fileInput1">
    
    <button id="uppf1"> DataFile</button>
    <input style="display:none;" type="file" id="fileInput">
    
    <input style="display:none;" autocomplete="off" id="p1" placeholder="Enter Sky Password.." value="S">
    <input style="display:none;" autocomplete="off" id="p2" placeholder="Enter Breeze Password.."  >
   
   <select id="selcat" onchange="chsel(this)">
      <option value=""> Select Docs</option>ll
      <option value="single-data-details"> Sigle Data</option>
      <option value="double-data-details"> Create format</option>
      <option value="aadhar-details"> Aadhar Card </option>
      <option value="pancard-details"> Pan Card</option>
      <option value="voter-id-details"> Voter Id Card </option>
      
   </select>
   <i class="fa-solid fa-download" onclick="down()"></i>
   
    </div>
    
    <center><div id="sug-box" class="sug-box"></div></center>
    
    
    
    
    <div style="display:none;" id="aadhar-details" class="sele aadhaar">
    <button style="background-color:#2C2F33;border:0px solid black;border-bottom:1px solid grey;" onclick="addCh(this)"> Create Feild </button>
    <input oninput="showSug(this)" id="aadhaar-refer" placeholder="Aadhaar Refrence(e.g. my aadhaar)"> 
    <input id="aadhaar-name" placeholder="Name">  
    <input id="aadhaar-number" placeholder="Number">
    <input id="aadhaar-dob" placeholder="Dob">
    <input id="aadhaar-gender" placeholder="gender"> 
    <input id="aadhaar-address" placeholder="address"> 
    <input id="aadhaar-linked-phnumber" placeholder="linked phone number"> 
    <input id="aadhaar-enrollment-number" placeholder="enrollment number">
    <button style="background-color:#4961E1;border:0px solid black;border-bottom:1px solid grey;" onclick="upd('aadhar-details')"> Save Data </button>
    </div>
    
    <div style="display:none;" id="pancard-details" class="sele pancard">
    <button style="background-color:#2C2F33;border:0px solid black;border-bottom:1px solid grey;" onclick="addCh(this)"> Create Feild </button>
    <input oninput="showSug(this)" id="pancard-refer" placeholder="PAN Card Reference (e.g. my PAN card)"> 
    <input id="pan-name" placeholder="Name"> 
    <input id="pan-father-name" placeholder="Father Name"> 
    <input id="pan-number" placeholder="Number"> 
    <input id="pan-dob" placeholder="DOB"> 
    <input id="pan-gender" placeholder="Gender"> 
    <button style="background-color:#4961E1;border:0px solid black;border-bottom:1px solid grey;" onclick="upd('pancard-details')"> Save Data </button>
    </div>
    
    <div style="display:none;" id="voter-id-details" class="sele voterID">
       <button style="background-color:#2C2F33;border:0px solid black;border-bottom:1px solid grey;" onclick="addCh(this)"> Create Feild </button>
       <input oninput="showSug(this)" id="voter-id-refer" placeholder="Voter ID Card(e.g. my Vote card)"> 
       <input id="voterID-name" placeholder="Name ( enter both lang )">  
       <input id="voterID-other" placeholder="Other Name">  
       <input id="voterID-number" placeholder="Number">  
       <input id="voterID-dob" placeholder="DOB"> 
       <input id="voterID-gender" placeholder="Gender">  
       <input id="voterID-address" placeholder="Address"> 
    <button style="background-color:#4961E1;border:0px solid black;border-bottom:1px solid grey;" onclick="upd('voter-id-details')"> Save Data </button>
    </div>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    <div style="display:none;" id="double-data-details" class="sele double">
    <button style="background-color:#2C2F33;border:0px solid black;border-bottom:1px solid grey;" onclick="addCh(this)"> Create Feild </button>
    <input id="double-data-refer" oninput="showSug(this)" placeholder="head Reference (e.g. device)">
    <input id="device-name" ondblclick="remC(this)" placeholder="Device Name"> 
    <input id="device-imei-number" ondblclick="remC(this)" placeholder="Device IMEI Number"> 
    
    <button style="background-color:#4961E1;border:0px solid black;border-bottom:1px solid grey;" onclick="upd('double-data-details')"> Save Data </button>
    </div>
    
    
    
    
    
    
    <div style="display:none;" id="single-data-details" class="sele single">
    
    <input id="single-data-refer" style="background-color:#184D4D;" oninput="showSug(this)" placeholder="Data Reference (e.g. IMEI NUMNER)">
    <input id="single-data-value" style="background-color:black;border:0px solid black;border-bottom:1px solid grey;" placeholder="Data (e.g. 38283828338)">
 
    <button style="background-color:#4961E1;border:0px solid black;border-bottom:1px solid grey;" onclick="upd('single-data-details')"> Save Data </button>
    </div>
    
    
    <button style="display:none;" onclick="upd()">Upload</button>
    
    
    <div class="pr">
    <pre id="out">{}</pre>
<pre id="out2">{}</pre>
</div>

<a href="slogin.html" > Click Here to login into Sparrow </a>
    <script>
    
    function remC(x){
    x.remove();
    }
    
    function addCh(xx){
    let chil=xx.parentElement;
    let clen=chil.children.length;
    let newC=document.createElement("input");
    let idin=prompt("Enter Name Of Feild(.e.g. imei number) : ").toString().trim().replace(/ /g,"-");
    newC.id=idin;
    newC.style.backgroundColor="#2C2F33";
    newC.style.color="white";
    newC.placeholder=idin;
    newC.ondblclick=()=>remC(newC);
    chil.insertBefore(newC,chil.children[clen-1]);
    
    }
    
    function chsel(x){
    
    Array.from(document.getElementsByClassName("sele")).forEach(x=>x.style.display="none");
    document.getElementById(x.value).style.display="";
    }
    
    function ddoc(){
    document.getElementById("dic").open=!document.getElementById("dic").open;
    }
    
    document.getElementById("uppf").addEventListener("click", function() {
    document.getElementById("fileInput1").click();
    });
    
    document.getElementById("fileInput1").addEventListener("change", (e) => {
    upPas();
    });
    
    document.getElementById("uppf1").addEventListener("click", function() {
    document.getElementById("fileInput").click();
    });
    
    document.getElementById("fileInput").addEventListener("change", (e) => {
    upload();
    });
    
    function toast(ms,du=4000,bg,cl) {
    let config = {
    text:ms,
    duration: du,
    close: cl,
    gravity: "top",
    position: "center",
    stopOnFocus: true,
    backgroundColor:bg,
    className: "custom-toast",
    };
    
    Toastify(config).showToast();
    }
    
    
    let d = {};
    let ed = {};
    
    
    function getAD(dnam, stnam) {
    let requ = indexedDB.open(dnam);
    let pinPro= prompt("Enter Sparrow Pin To Read Data File...");
    requ.onsuccess = function (event) {
    let db = event.target.result;
    let transaction = db.transaction(stnam, "readonly");
    let store = transaction.objectStore(stnam);
    let getAR = store.getAll();
    try{
    getAR.onsuccess = function () {
    let filP=getAR.result[0].filePass; //1234
 
    let filPF=getAR.result[0].passUrl;//pass
    let filDDP=CryptoJS.AES.decrypt(filP,pinPro.toString()).toString(CryptoJS.enc.Utf8);
    // alert(filDDP);//nkn
    let filPPD=CryptoJS.AES.decrypt(filPF,filDDP.toString()).toString(CryptoJS.enc.Utf8);
    //filPPD["sky"].toString();
    let filPX=JSON.parse(filPPD);
  // alert(filPX["sky"]);
    document.getElementById("p1").value=filPX["sky"];
    document.getElementById("p2").value=filPX["breez"];
    document.getElementById("fileInput1").style.display="none";
    
    
    };
    }catch(e){
    return;
    
    }
    
    getAR.onerror = function () {
    console.log("Error getting data:", getAR.error);
    };
    };
    
    requ.onerror = function () {
    console.log("Error opening database:", requ.error);
    };
    }
    
    async function checkDB() {
    let dbs = await indexedDB.databases();
    let exists = dbs.some(db => db.name === "SPRROWGEN");
    
    if (!exists) {
    console.log("Database does not exist");
    return;
    }else{
    
    getAD("SPRROWGEN","bird");
    
    }
    
    
    }
  checkDB();
    
    
    
    
    
    
    
    function upd(ids) {
    
    let skyp = document.getElementById("p1").value.trim();
   
    let temd={};
    let temd1={};
    
    let getEl= document.getElementById(ids);
    let chilen= getEl.children.length;
   
    if(chilen<=3){
    
    d[getEl.children[0].value.trim().replace(/ /g,"-").toLowerCase().toString()]=getEl.children[1].value.trim().replace(/ /g,"-");
    ed[getEl.children[0].value.trim().replace(/ /g,"-").toLowerCase().toString()]=CryptoJS.AES.encrypt(getEl.children[1].value.trim().replace(/ /g,"-").toString(),skyp).toString();
    document.getElementById("out").textContent = JSON.stringify(d, null, 2);
    document.getElementById("out2").textContent = JSON.stringify(ed, null, 2);
    
    
    }else{
    for(let x=2;x<chilen-1;x++){
    
    let chi=getEl.children[x];
    if(chi.value==="" || chi.value===" "){
    toast("please enter all feild",3000,"red",false);
    return
    }
    
    temd[chi.id.trim().replace(/ /g,"-").toString()]=chi.value.trim().replace(/ /g,"-").toString();
    temd1[chi.id.trim().replace(/ /g,"-")]= CryptoJS.AES.encrypt(chi.value.trim().replace(/ /g,"-").toString(),skyp).toString();
   chi.value="";
    }
    
    let refs=getEl.children[1].value.trim().replace(/ /g,"-").toLowerCase().toString();
    d[refs.toString()]=temd;
    ed[refs.toString()]=temd1;
    
    document.getElementById("out").textContent = JSON.stringify(d, null, 2);
    document.getElementById("out2").textContent = JSON.stringify(ed, null, 2);
    
    
 }
    
    
    }
    
    
    
    
    
    
    
    function down() {
    let v2 = document.getElementById("p2").value.trim();
    if (v2 === "") {
    toast("Key required for encryption.",3000,"red",false);
    return;
    }
    
    let enc = CryptoJS.AES.encrypt(JSON.stringify(ed), v2).toString();
    let blob = new Blob([enc], { type: "application/json" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "data.json";
    a.click();
    }
    
    function upload() {
   // alert(JSON.stringify(d));
   // alert(JSON.stringify(ed));
    let fileInput = document.getElementById("fileInput");
    let file = fileInput.files[0];
    
    if (!file) {
    toast("Please select a file first!",3000,"red",false);
    return;
    }
    
    let reader = new FileReader();
    reader.onload = function (event) {
    let encPDA = event.target.result;
    let v2 = document.getElementById("p2").value.trim();
   let v1= document.getElementById("p1").value.trim();
    if (v2 === "") {
    toast("Please Upload the pass file first...",3000,"red",false);
    document.getElementById("uppf1").style.backgroundColor="red";
    document.getElementById("uppf1").style.border="2px solid black";
    
    return;
    }
    
    try {
    let decPDA = CryptoJS.AES.decrypt(encPDA, v2).toString(CryptoJS.enc.Utf8);
    //alert(decPDA);
    let parDa = JSON.parse(decPDA);
    
    document.getElementById("out2").textContent = JSON.stringify(parDa, null, 2);
    document.getElementById("uppf1").style.backgroundColor="green";
    document.getElementById("uppf1").style.border="2px solid black";
    m = {};
    
    function allG(obs) {
    Object.keys(obs)
    .map(key => {
    if (typeof obs[key] === "object" && obs[key] !== null) {
  //  alert(m[key]);
    return m[key]=allG(obs[key]);
    }else{
   // alert(m[key]);
    return m[key]=CryptoJS.AES.decrypt(obs[key],v1).toString(CryptoJS.enc.Utf8);
    }
    })
    .filter(Boolean)
    .join(', ');
    }
    
    
  let temp={};
  Object.keys(parDa).forEach((x)=>{
  
  if(typeof(parDa[x])==="object"){
  temp[x]={};
  Object.keys(parDa[x]).forEach((vx)=>{
  
  temp[x][vx]=CryptoJS.AES.decrypt(parDa[x][vx], v1).toString(CryptoJS.enc.Utf8);
//  alert(JSON.stringify(temp));
  });
 
  }else{
  
  temp[x]=CryptoJS.AES.decrypt(parDa[x],v1).toString(CryptoJS.enc.Utf8);
 // alert(JSON.stringify(temp));
  }
  
  
  });
  d=temp;
 //alert(JSON.stringify(d));
   document.getElementById("out").textContent = JSON.stringify(d,null,2);
    ed = parDa;
    
    
  //  alert(JSON.stringify(d));
   // alert(JSON.stringify(ed));
    } catch (e) {
   // alert("Decryption failed. Check your password.");
   toast(e,2000,"red",false);
    }
    };
    
    reader.readAsText(file);
    }
    
    
    function upPas() {
    let fileInput = document.getElementById("fileInput1");
    let file = fileInput.files[0];
    
    if (!file) {
    toast("Please select a file first!",3000,"red",false);
    return;
    }
    
    let reader = new FileReader();
    reader.onload = function (event) {
    let encPDA = event.target.result;
    let v2 = prompt("Enter Breeze Password To Read Pass File..");
    
    if (v2 === "") {
    toast("Breeze Password Required For Reading File...",3000,"red",false);
    return;
    }
    
    try {
    let decPDA = CryptoJS.AES.decrypt(encPDA, v2).toString(CryptoJS.enc.Utf8);
    let parDa = JSON.parse(decPDA);
    
    document.getElementById("p1").value=parDa["sky"];
    document.getElementById("p2").value=parDa["breez"];
    toast("Pass File Read successfully...",3000,"green",false);
    document.getElementById("uppf").style.backgroundColor="green";
    document.getElementById("uppf").style.border="2px solid black";
   // document.getElementById("out2").textContent = JSON.stringify(parDa, null, 2);
    
  //  d = {};
  // for (let key in parDa) {
 //  d[key] = CryptoJS.AES.decrypt(parDa[key],parDa["sky"]).toString(CryptoJS.enc.Utf8);
    }
    
  //  document.getElementById("out").textContent = JSON.stringify(d, null, 2);
  // ed = parDa;
     catch (e) {
    toast("File Reading Failed, Due to Incorrect Password.",3000,"red",false);
    document.getElementById("uppf").style.backgroundColor="red";
    document.getElementById("uppf").style.border="2px solid black";
    }
    };
    
    reader.readAsText(file);
    }
    
    
    
    function showSug(v) {
    
    
    let val = v.value.toLowerCase();
    let sugBox = document.getElementById("sug-box");
    sugBox.innerHTML = "";
    
    if (!val) { 
    sugBox.style.display = "none"; 
    return; 
    }
    
    Object.keys(ed).forEach(key => {
   // alert(d[key]);
    if (key.toLowerCase().includes(val)) {
    let div = document.createElement("div");
    div.className = "sug-item";
    div.innerText = key;
    div.style.height="20px";
    div.onclick = () => { 
    document.getElementById(v.id).value = key;
    let ch=v.parentElement.children;
     let chl=v.parentElement.children.length;
    
     if(typeof(d[key])==="object"){
     let xc=2;
     Object.keys(d[key]).forEach((c)=>{
     
     
     ch[xc].value=d[key][c];
     xc+=1;
     
     
     });
     
     
     }else if(chl==3){
     ch[1].value=d[key];
     }
    
    
    sugBox.style.display = "none"; 
    };
    sugBox.appendChild(div);
    }
    });
    
    sugBox.style.display = sugBox.children.length ? "block" : "none";
    }
    
    
    </script>

</body>
</html>