
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>White-Sparrow</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/x-icon" href="icon512_maskable.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 10px;
        }

        h3 {
            color: #fff;
            font-size: 18px;
        }

        input, button ,select{
            display: block;
            width: 90%;
            margin: 8px auto;
            padding: 12px;
            border: 1px solid #808080;
            border-radius: 5px;
            font-size: 14px;
        }

        input ,select{
            background: #000;
            color: #fff;
        }

        input::placeholder {
            color: #fff;
        }

        button {
            background: #000;
            color: #fff;
            cursor: pointer;
        }

        button:active {
            background: #111;
        }

        pre {
        
            background: #000;
            padding: 10px;
            border: 1px solid #808080;
            border-radius: 5px;
            text-align: left;
            width: 48%;
            margin: 8px auto;
            font-size: 12px;
            overflow-x: auto;
        }
        .pr{
        display:flex;
        width:100%;
        gap:10px;
        
        }
        
        a{
        color:white;
        }
        
        .fa-circle-info{
        position:absolute;
        z-index:30;
        top:10;
        font-size:1.5rem;
        right:5;
        color:green;
        }
        a{
        text-decoration:none;
        color:green;
        
        }
        
        details {
        margin-bottom: 10px;
        border:none;
        padding: 10px;
        text-align:left;
        border-radius: 5px;
        background-color:black;
        }
        summary {
        font-weight: bold;
        cursor: pointer;
        }
        .warning {
        color: red;
        font-weight: bold;
        }
        
        select,.sele>input,.sele>button{
        border:1px solid red;
        }
        #out{
        border:3px solid green;
        background-color:black;
        color:white;
        }
        #out2{
        background-color:black;
        border:3px solid skyblue;
        
        color:white;
        }
        
        
    </style>
    <link rel="stylesheet" href=" https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>
<body>
<i onclick="ddoc()" class="fa-solid fa-circle-info"></i>
    <h2>White Sparrow </h2>
    
    <details id="dic">
    <summary style="display:none;">sjjs</summary>
    <details>
    <summary>Step 1 : Upload Password File (if exists)</summary>
    <p>Enter the <strong>Breeze password</strong> to read <strong>Sky & Breeze</strong> values and autofill input boxes.</p>
    </details>
    
    <details>
    <summary>Step 2 : Upload Data File (if exists)</summary>
    <p>Requires the <strong>password file first</strong>. Reads and displays <strong>encrypted & decrypted</strong> data.</p>
    </details>
    
    <details>
    <summary>Step 3 : Create Files</summary>
    <p>If no files exist, first create a <strong>password file in Black Sparrow</strong>, then a <strong>data file in White Sparrow</strong>.</p>
    </details>
    
    <details>
    <summary>Step 4 : Upload Data</summary>
    <p>Enter <strong>key-value pairs</strong> (data reference & value). If a data file exists, it updates the data.</p>
    </details>
    
    <details>
    <summary>Step 5 : Download Data File</summary>
    <p>Saves the encrypted data file using the <strong>Breeze password</strong>.</p>
    </details>
    <p> Reload The Page If Any Unknkwn Problem Occured</p>
    <p class="warning"> If the Breeze password is forgotten, everything is lost.</p>
    <a href="sdoc.html" > Click Here Read Sparrow Documentation.</a>
    </details>
    
    <button id="uppf"> Upload Pass File</button>
    <input style="display:none;" type="file" id="fileInput1">
    
    <button id="uppf1"> Upload Data File if it Exists</button>
    <input style="display:none;" type="file" id="fileInput">
    
    <input style="display:none;" autocomplete="off" id="p1" placeholder="Enter Sky Password.." >
    <input style="display:none;" autocomplete="off" id="p2" placeholder="Enter Breeze Password.."  >
   
   <select id="selcat" onchange="chsel(this)">
      <option value=""> Select Category </option>ll
      <option value="aadhar-details"> Aadhar Card </option>
      <option value="pancard-details"> Pan Card</option>
      <option value="single-data-details"> Single Data</option>
      
   </select>
    
    <div style="display:none;" id="aadhar-details" class="sele aadhaar">
    
    <input id="aadhaar-refer" placeholder="Aadhaar Refrence(e.g. my aadhaar)">
    <input id="aadhaar-name" placeholder="Name">
    <input id="aadhaar-number" placeholder="Number">
    <input id="aadhaar-dob" placeholder="Dob">
    <input id="aadhaar-gender" placeholder="gender">
    <input id="aadhaar-address" placeholder="address">
    <input id="aadhaar-linked-phnumber" placeholder="linked phone number">
    <input id="aadhaar-enrollment-number" placeholder="enrollment number">
    
    <button onclick="upd('aadhar-details')"> Save Data </button>
    </div>
    
    <div style="display:none;" id="pancard-details" class="sele pancard">
    
    <input id="pancard-refer" placeholder="PAN Card Reference (e.g. my PAN card)">
    <input id="pancard-name" placeholder="Name">
    <input id="pancard-number" placeholder="Number">
    <input id="pancard-dob" placeholder="DOB">
    <input id="pancard-gender" placeholder="Gender">
    <input id="pancard-address" placeholder="Address">
    <input id="pancard-linked-phnumber" placeholder="Linked Phone Number">
    <input id="pancard-enrollment-number" placeholder="Enrollment Number">
    
    <button onclick="upd('pancard-details')"> Save Data </button>
    </div>
    
    <div style="display:none;" id="single-data-details" class="sele pancard">
    
    <input id="single-data-refer" placeholder="Data Reference (e.g. IMEI NUMNER)">
    <input id="single-data-value" placeholder="Data (e.g. 38283828338)">
 
    <button onclick="upd('single-data-details')"> Save Data </button>
    </div>
    
    
    <button style="display:none;" onclick="upd()">Upload</button>
    <button onclick="down()">Download</button>
    
    
    <div class="pr">
    <pre id="out">{}</pre>
<pre id="out2">{}</pre>
</div>

<a href="slogin.html" > Click Here to login into Sparrow </a>
    <script>
    
    
    function chsel(x){
    
    Array.from(document.getElementsByClassName("sele")).forEach(x=>x.style.display="none");
    document.getElementById(x.value).style.display="";
    }
    
    function ddoc(){
    document.getElementById("dic").open=!document.getElementById("dic").open;
    }
    
    document.getElementById("uppf").addEventListener("click", function() {
    document.getElementById("fileInput1").click();
    });
    
    document.getElementById("fileInput1").addEventListener("change", (e) => {
    upPas();
    });
    
    document.getElementById("uppf1").addEventListener("click", function() {
    document.getElementById("fileInput").click();
    });
    
    document.getElementById("fileInput").addEventListener("change", (e) => {
    upload();
    });
    
    
    
    
    let d = {};
    let ed = {};
    
    
    function getAD(dnam, stnam) {
    let requ = indexedDB.open(dnam);
    let pinPro= prompt("Enter Sparrow Pin To Read Data File...");
    requ.onsuccess = function (event) {
    let db = event.target.result;
    let transaction = db.transaction(stnam, "readonly");
    let store = transaction.objectStore(stnam);
    let getAR = store.getAll();
    try{
    getAR.onsuccess = function () {
    let filP=getAR.result[0].filePass; //1234
 
    let filPF=getAR.result[0].passUrl;//pass
    let filDDP=CryptoJS.AES.decrypt(filP,pinPro.toString()).toString(CryptoJS.enc.Utf8);
    // alert(filDDP);//nkn
    let filPPD=CryptoJS.AES.decrypt(filPF,filDDP.toString()).toString(CryptoJS.enc.Utf8);
    //filPPD["sky"].toString();
    let filPX=JSON.parse(filPPD);
  // alert(filPX["sky"]);
    document.getElementById("p1").value=filPX["sky"];
    document.getElementById("p2").value=filPX["breez"];
    document.getElementById("fileInput1").style.display="none";
    
    
    };
    }catch(e){
    return;
    
    }
    
    getAR.onerror = function () {
    console.log("Error getting data:", getAR.error);
    };
    };
    
    requ.onerror = function () {
    console.log("Error opening database:", requ.error);
    };
    }
    
    async function checkDB() {
    let dbs = await indexedDB.databases();
    let exists = dbs.some(db => db.name === "SPRROWGEN");
    
    if (!exists) {
    console.log("Database does not exist");
    return;
    }else{
    
    getAD("SPRROWGEN","bird");
    
    }
    
    
    }
    checkDB();
    
    
    
    
    
    
    
    function upd(ids) {
    
    let skyp = document.getElementById("p1").value.trim();
   
    let temd={};
    let temd1={};
    
    let getEl= document.getElementById(ids);
    let chilen= getEl.children.length;
   
    if(chilen<=3){
    
    d[getEl.children[0].value.trim().replace(/ /g,"-").toLowerCase().toString()]=getEl.children[1].value.trim().replace(/ /g,"-");
    ed[getEl.children[0].value.trim().replace(/ /g,"-").toLowerCase().toString()]=CryptoJS.AES.encrypt(getEl.children[1].value.trim().replace(/ /g,"-").toString(),skyp).toString();
    document.getElementById("out").textContent = JSON.stringify(d, null, 2);
    document.getElementById("out2").textContent = JSON.stringify(ed, null, 2);
    
    
    }else{
    for(let x=1;x<chilen-1;x++){
    
    let chi=getEl.children[x];
    if(chi.value==="" || chi.value===null || getEl.children[0].value===""){
    alert("please enter all feild");
    return
    }
    temd[chi.id.trim().replace(/ /g,"-").toString()]=chi.value.trim().replace(/ /g,"-").toString();
    temd1[chi.id.trim().replace(/ /g,"-")]= CryptoJS.AES.encrypt(chi.value.trim().replace(/ /g,"-").toString(),skyp).toString();
    
    }
    
    let refs=getEl.children[0].value.trim().replace(/ /g,"-").toLowerCase().toString();
    d[refs.toString()]=temd;
    ed[refs.toString()]=temd1;
    
    document.getElementById("out").textContent = JSON.stringify(d, null, 2);
    document.getElementById("out2").textContent = JSON.stringify(ed, null, 2);
    
    
 }
    
    
    }
    
    
    
    
    
    
    
    function down() {
    let v2 = document.getElementById("p2").value.trim();
    if (v2 === "") {
    alert("Key required for encryption.");
    return;
    }
    
    let enc = CryptoJS.AES.encrypt(JSON.stringify(ed), v2).toString();
    let blob = new Blob([enc], { type: "application/json" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "data.json";
    a.click();
    }
    
    function upload() {
   // alert(JSON.stringify(d));
   // alert(JSON.stringify(ed));
    let fileInput = document.getElementById("fileInput");
    let file = fileInput.files[0];
    
    if (!file) {
    alert("Please select a file first!");
    return;
    }
    
    let reader = new FileReader();
    reader.onload = function (event) {
    let encPDA = event.target.result;
    let v2 = document.getElementById("p2").value.trim();
    
    if (v2 === "") {
    alert("Please Upload the pass file or enter Sky,Breeze Password in input Boxes...");
    document.getElementById("uppf1").style.backgroundColor="red";
    document.getElementById("uppf1").style.border="2px solid black";
    
    return;
    }
    
    try {
    let decPDA = CryptoJS.AES.decrypt(encPDA, v2).toString(CryptoJS.enc.Utf8);
    let parDa = JSON.parse(decPDA);
    
    document.getElementById("out2").textContent = JSON.stringify(parDa, null, 2);
    document.getElementById("uppf1").style.backgroundColor="green";
    document.getElementById("uppf1").style.border="2px solid black";
    m = {};
    
    function allG(obs) {
    Object.keys(obs)
    .map(key => {
    if (typeof obs[key] === "object" && obs[key] !== null) {
  //  alert(m[key]);
    return m[key]=allG(obs[key]);
    }else{
   // alert(m[key]);
    return m[key]=CryptoJS.AES.decrypt(obs[key],"S").toString(CryptoJS.enc.Utf8);
    }
    })
    .filter(Boolean)
    .join(', ');
    }
    
    
    
  Object.keys(parDa).forEach((x)=>{
  if(typeof(parDa[x])==="object"){
  
  d[x]=allG(parDa[x]);
//  alert(JSON.stringify(parDa[x]));
 // alert(JSON.stringify(d));
  
  }else{
//  alert(parDa[x]);
  d[x]=parDa[x];
  //alert(JSON.stringify(d));
  }
  });
  
 
   document.getElementById("out").textContent = JSON.stringify(d);
    ed = parDa;
    
    
  //  alert(JSON.stringify(d));
   // alert(JSON.stringify(ed));
    } catch (e) {
   // alert("Decryption failed. Check your password.");
   alert(e);
    }
    };
    
    reader.readAsText(file);
    }
    
    
    function upPas() {
    let fileInput = document.getElementById("fileInput1");
    let file = fileInput.files[0];
    
    if (!file) {
    alert("Please select a file first!");
    return;
    }
    
    let reader = new FileReader();
    reader.onload = function (event) {
    let encPDA = event.target.result;
    let v2 = prompt("Enter Breeze Password To Read Pass File..");
    
    if (v2 === "") {
    alert("Breeze Password Required For Reading File...");
    return;
    }
    
    try {
    let decPDA = CryptoJS.AES.decrypt(encPDA, v2).toString(CryptoJS.enc.Utf8);
    let parDa = JSON.parse(decPDA);
    
    document.getElementById("p1").value=parDa["sky"];
    document.getElementById("p2").value=parDa["breez"];
    alert("Pass File Read successfully...");
    document.getElementById("uppf").style.backgroundColor="green";
    document.getElementById("uppf").style.border="2px solid black";
   // document.getElementById("out2").textContent = JSON.stringify(parDa, null, 2);
    
  //  d = {};
  // for (let key in parDa) {
 //  d[key] = CryptoJS.AES.decrypt(parDa[key],parDa["sky"]).toString(CryptoJS.enc.Utf8);
    }
    
  //  document.getElementById("out").textContent = JSON.stringify(d, null, 2);
  // ed = parDa;
     catch (e) {
    alert("File Reading Failed, Due to Incorrect Password.");
    document.getElementById("uppf").style.backgroundColor="red";
    document.getElementById("uppf").style.border="2px solid black";
    }
    };
    
    reader.readAsText(file);
    }
    </script>

</body>
</html>